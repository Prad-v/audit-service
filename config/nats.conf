# NATS Server Configuration for Audit Log Framework

# Server settings
server_name: audit-nats
listen: 0.0.0.0:4222
http_port: 8222

# JetStream configuration
jetstream {
    store_dir: /data
    max_memory_store: 1GB
    max_file_store: 10GB
}

# Logging
log_file: "/dev/stdout"
logtime: true
debug: false
trace: false

# Limits
max_connections: 1000
max_control_line: 4KB
max_payload: 1MB
max_pending: 64MB
max_subscriptions: 0

# Timeouts
ping_interval: 2m
ping_max: 2
write_deadline: 10s

# Authentication (disabled for local development)
# authorization {
#     user: audit_user
#     password: audit_password
# }

# Clustering (for future use)
cluster {
    name: audit-cluster
    listen: 0.0.0.0:6222
    
    # Routes to other servers
    # routes = [
    #     nats-route://nats1:6222
    #     nats-route://nats2:6222
    # ]
}

# Monitoring
monitor_port: 8222

# System account (for monitoring and management)
system_account: SYS

# Accounts configuration
accounts {
    SYS {
        users = [
            { user: "admin", pass: "admin" }
        ]
    }
    
    AUDIT {
        users = [
            { user: "audit_service", pass: "audit_password" }
        ]
        
        jetstream: enabled
        
        # Limits for the audit account
        limits {
            max_connections: 100
            max_leafnodes: 0
            max_data: 10GB
            max_exports: 0
            max_imports: 0
            max_wildcards: 0
            max_streams: 10
            max_consumers: 50
        }
    }
}

# Default account
default_account: AUDIT

# TLS configuration (disabled for local development)
# tls {
#     cert_file: "/etc/nats/server-cert.pem"
#     key_file: "/etc/nats/server-key.pem"
#     ca_file: "/etc/nats/ca.pem"
#     verify: true
#     timeout: 5
# }

# Profiling (for development)
prof_port: 6060

# PID file
pid_file: "/tmp/nats.pid"

# Maximum number of CPU cores to use
# max_procs: 0  # 0 means use all available cores